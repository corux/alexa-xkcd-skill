#!/usr/bin/env babel-node

import fs from 'fs';
import path from 'path';
import lambda from 'node-aws-lambda';
import nomnom from 'nomnom';
import process from 'process';

const exists = (filename) => fs.existsSync(filename) ? undefined : `${filename} does not exist`;

let { config, zip } = nomnom
  .script('deploy')
  .option('config', { required: true, callback: exists })
  .option('zip', { full: 'package', abbr: 'p', required: true, callback: exists })
  .parse();

config = require(path.join(process.cwd(), config));

lambda.deploy(zip, config, function (error) {
  if (error) {
    console.error('Deployment failed:', error);
    process.exit(1);
  } else {
    console.info('Deployment successful');
    process.exit(0);
  }
});
